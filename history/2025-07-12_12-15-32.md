## Prompt

I'd like you to familiarize yourself with the code and documentation, and then perform the below refactor task:

Goal - make the vtuber profile and themes (avatar and background image, etc) configurable via the database. Currently I store the profile, which includes the metadata information about the website, name of the vtuber, and external links in a JSON file. Also, currently image path and background path are hard-coded. I want you to create a proper database schema using prisma and refactor the code so it reads the profile, a list of themes and all the songs from the database upon start and then render the web page.

The goal of the change is that no code change is necessary for standing up a web site for a different vtuber, just swapping the database URL. Several things to consider:

- I want to have multiple themes where the user could change. A theme could start with just an avatar image and a background image URL, which the app could assume they point to CDN/object storage locations.

### Follow-up 2
Ok, now please modify the admin page so I can edit/update the profile and themes. Add NextJS actions to handle the CRUD APIs. To start with, just tables that allows me to edit the fields, with ergonomic UX.

### Follow-up 3
Error: A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.

When I click the edit profile

### Follow-up 4
Could you make all the UI Chinese?

### Follow-up 5
Please remove bannerImagePath and just keep avatar and background, and update your API and admin components

### Follow-up 6
Could you implement the actual API interaction for editing themes and links?

### Follow-up 7
When I edit the theme, instead of editing on the original panel, I get another card popped up below the original. Could you fix it?

### Follow-up 8
I noticed that when saving themes, you actually re-queried the profile, which is not good. We might need some local but contexted state here. Could you explore using jotai to implement all the states for the admin page and reduce unnecessary queries?

### Follow-up 9
Now in the profile panel I couldn't see any profile though I have created one

### Follow-up 10
Could you fix the edit issue in link panel? The same as theme panel. When I edit, another card popped up instead of just editing the original card

### Follow-up 11
Ok the functionality is good from my testing. Now make a couple improvement to the code and refactor:

- You use a very intricate "double-state" scheme, where state update is propagated both via API to the server and locally via setAtom. Don't do this, I want the atoms to be derived from the query result of the server and an update sends update to the server and re-derives the atom. Please implement this using jotai-tanstack-query to handle automatic invalidation and refetch

- You don't need to define your own Song/Profile types if they are identical to the prisma-generated types right? Also, I think EditableSong is a mistake, just use the Song type directly from the db. Make it simple and easy to follow.

- Please distinguish atom and form data. Form data are better confined as local component state. Please don't make them atoms. Instead, create dedicated Form components for managing form data for each of the resources we are editing, and have parent components pass in props that translates form data into mutations using the onSubmit mechanism

### Follow-up 12
Now when I login to the admin page I see nothing. 

### Follow-up 13
Nope it now shows a spinning loader forever

### Follow-up 14
Nope
AdminLayout Debug: 
{isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
activeTab
: 
"songs"
filteredSongsLength
: 
0
isLoadingSongs
: 
true
songsError
: 
null
songsQueryData
: 
0

By the way, please remove all usage of EditableSong and just use a single Song type

### Follow-up 15

Ctrl+K to generate a command
Ctrl+K to generate a command
Nope
AdminLayout Debug: 
{isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
activeTab
: 
"songs"
filteredSongsLength
: 
0
isLoadingSongs
: 
true
songsError
: 
null
songsQueryData
: 
0

By the way, please remove all usage of EditableSong and just use a single Song type

I see the issue! The query is stuck in a loading state (isLoadingSongs: true) and never completes. This suggests there's an issue with the query setup or the server action. Let me first remove all EditableSong usage and use the Song type directly, then fix the query issue.
Now let me update the AdminLayout to use Song type directly:
Now let me update the crud.ts file to remove EditableSong usage:
I need to fix the bucket_url references. The bucket_url is stored in the extra field. Let me fix this:
Now let me check if there are any other components that need to be updated to use Song type instead of EditableSong. Let me check the SongTable component:
I need to update the SongTable component to use Song type instead of EditableSong:
I need to fix the bucket_url reference in SongTable:
Now let me check the EditPanel component:
I need to update the EditPanel to use Song type:
I need to fix the remaining EditableSong reference and bucket_url issue:
Let me find and fix the bucket_url reference:
I need to fix the bucket_url references in EditPanel:
The string to replace was not found in the file.
Now let me check if there are any other components that need updating. Let me also check if the query issue is resolved by testing a simple approach. The issue might be that the query is not being triggered properly. Let me try a different approach by using a simpler query setup:
Now let me also add some debugging to the server action to see if it's being called:
Now let's test this. The issue might be that the query is not being triggered at all. Can you check the browser console to see if you see the "getAllSongs called" message? This will help us determine if the server action is being called or if there's an issue with the query setup.
Also, can you try clicking the "刷新" (refresh) button to see if that triggers the query?
Still pending, server log is not logged. Also the debug console shows up a lot:

AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}
AdminLayout.tsx:43 AdminLayout Debug: {isLoadingSongs: true, songsError: null, filteredSongsLength: 0, activeTab: 'songs', songsQueryData: 0}


The issue is clear now! The query is stuck in a loading state and never actually calls the server action. This suggests there's a problem with the jotai-tanstack-query setup. The query is not being triggered at all.
Let me first remove the debug logging and then fix the query issue:
Now let me check if there's an issue with the jotai-tanstack-query setup. The problem might be that the query is not being properly initialized. Let me try a different approach by using a simpler query setup:
The issue might be that jotai-tanstack-query is not working properly in this setup. Let me try a different approach by using a regular Jotai atom with manual data fetching:
Now I need to update the AdminLayout to use the new manual fetching approach:
I need to fix the remaining songsQuery reference:
Now let me also remove the debug logging from the server action:
Now let's test this approach. The manual fetching should work better than the jotai-tanstack-query approach. Can you try accessing the admin page now? You should see:
The songs loading properly
Console logs showing "Fetching songs..." and "Songs fetched: X"
The songs appearing in the table
If this works, we can then update the other panels (profile, themes, external links) to use the same manual fetching approach.
Get this when navigating to the profile tab
src\app\admin\components\ProfilePanel.tsx (32:42) @ createProfileMutationAtom

  30 | 	
  31 | 	// Mutations
> 32 | 	const [createProfileMutation] = useAtom(createProfileMutationAtom);
     | 	                                        ^
  33 | 	const [updateProfileMutation] = useAtom(updateProfileMutationAtom);
  34 |
  35 | 	const handleEdit = () => {